<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using the ExPanD Notebook function • ExPanDaR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using the ExPanD Notebook function">
<meta property="og:description" content="ExPanDaR">
<meta property="og:image" content="/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-119053376-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-119053376-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ExPanDaR</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.5.3.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">ExPanD</li>
    <li>
      <a href="../articles/use_ExPanD.html">Using ExPanD for Panel Data Exploration</a>
    </li>
    <li>
      <a href="../articles/customize_ExPanD.html">Customize ExPanD</a>
    </li>
    <li>
      <a href="../articles/ExPanD_notebook.html">Using the ExPanD Notebook function</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">'ExPanDaR' functions</li>
    <li>
      <a href="../articles/ExPanDaR-functions.html">Using the functions of the 'ExPanDaR' package</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://www.github.com/joachim-gassen/ExPanDaR">
    <span class="fas fa-github"></span>
     
    Code repository
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ExPanD_notebook_files/header-attrs-2.6/header-attrs.js"></script><script src="ExPanD_notebook_files/kePrint-0.0.1/kePrint.js"></script><link href="ExPanD_notebook_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using the ExPanD Notebook function</h1>
                        <h4 class="author">Joachim Gassen</h4>
            
            <h4 class="date">2021-04-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/joachim-gassen/ExPanDaR/blob/master/vignettes/ExPanD_notebook.Rmd"><code>vignettes/ExPanD_notebook.Rmd</code></a></small>
      <div class="hidden name"><code>ExPanD_notebook.Rmd</code></div>

    </div>

    
    
<div id="exporting-a-notebook-from-within-expand" class="section level2">
<h2 class="hasAnchor">
<a href="#exporting-a-notebook-from-within-expand" class="anchor"></a>Exporting a Notebook from within ExPanD</h2>
<p>When you start ExPanD with the parameter <code>export_nb_option = TRUE</code>, you can export an R notebook containing the current state of your analysis from within the ExPanD app. Let’s see how that works and what the notebook has to offer. First, start ExPanD with the included panel data on U.S. corporations and the option to export notebooks.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://joachim-gassen.github.io/ExPanDaR/">ExPanDaR</a></span><span class="op">)</span>

<span class="fu"><a href="../reference/ExPanD.html">ExPanD</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">russell_3000</span>,  
       df_def <span class="op">=</span> <span class="va">russell_3000_data_def</span>, 
       df_name <span class="op">=</span> <span class="st">"Russell 3000"</span>,
       config_list <span class="op">=</span> <span class="va">ExPanD_config_russell_3000</span>,
       export_nb_option <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Next, after scrolling to the bottom of the page and clicking on the button below,</p>
<p><img src="figures/expand_export_button.png" width="80%" style="display: block; margin: auto;"></p>
<p>you should be rewarded with a file download dialog, asking you to store a file named <code>ExPanD_nb.zip</code>. Store and unzip it wherever you like. It contains two files</p>
<ul>
<li>A notebook file <code>ExPanD_nb_code.Rmd</code> and</li>
<li>a data file <code>ExPanD_nb_data.RData</code> containing data and variable definitions.</li>
</ul>
</div>
<div id="exploring-the-notebook-code" class="section level2">
<h2 class="hasAnchor">
<a href="#exploring-the-notebook-code" class="anchor"></a>Exploring the Notebook Code</h2>
<p>Use RStudio to open the notebook file. You can directly knit it (<code>Preview/Knit to HTML</code>) but in order to work with and extend it, it is useful to take a deeper look at its code first. The first chunk silently loads required libraries and sets some knitting defaults. The second chunk is more interesting:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">create_sample</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">df_def</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Set infinite numerical variables to NA</span>
  <span class="va">df</span><span class="op">[</span>, <span class="va">df_def</span><span class="op">$</span><span class="va">var_name</span><span class="op">[</span><span class="va">df_def</span><span class="op">$</span><span class="va">type</span> <span class="op">==</span> <span class="st">"numeric"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>, <span class="va">df_def</span><span class="op">$</span><span class="va">var_name</span><span class="op">[</span><span class="va">df_def</span><span class="op">$</span><span class="va">type</span> <span class="op">==</span> <span class="st">"numeric"</span><span class="op">]</span><span class="op">]</span>,
      <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html">is.finite</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="va">x</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>
 
  <span class="co"># Delete numerical variables that only contain NAs</span>
  <span class="va">all_na_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">df</span>, <span class="kw">function</span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">df_def</span> <span class="op">&lt;-</span> <span class="va">df_def</span><span class="op">[</span><span class="op">!</span><span class="va">all_na_vars</span>,<span class="op">]</span>
  <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span>, <span class="va">df_def</span><span class="op">$</span><span class="va">var_name</span><span class="op">]</span>
 
  <span class="co"># Drop observations that are NA in variables that are not allowed to</span>
  <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>, <span class="va">df_def</span><span class="op">$</span><span class="va">var_name</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">df_def</span><span class="op">$</span><span class="va">can_be_na</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span>
 
  <span class="co"># Outlier treatment as requested in ExPanD()</span>
  <span class="va">nums</span> <span class="op">&lt;-</span> <span class="va">df_def</span><span class="op">$</span><span class="va">var_name</span><span class="op">[</span><span class="va">df_def</span><span class="op">$</span><span class="va">type</span> <span class="op">==</span> <span class="st">"numeric"</span><span class="op">]</span>
  <span class="va">df</span><span class="op">[</span>, <span class="va">nums</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/treat_outliers.html">treat_outliers</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>, <span class="va">nums</span><span class="op">]</span>, <span class="fl">0.01</span>, <span class="cn">FALSE</span>, <span class="cn">NULL</span><span class="op">)</span>
 
  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">df</span>, df_def <span class="op">=</span> <span class="va">df_def</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
 
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"ExPanD_nb_data.Rdata"</span><span class="op">)</span>
 
<span class="va">smp_list</span> <span class="op">&lt;-</span> <span class="fu">create_sample</span><span class="op">(</span><span class="va">nb_df</span>, <span class="va">nb_df_def</span><span class="op">)</span>
<span class="va">smp</span> <span class="op">&lt;-</span> <span class="va">smp_list</span><span class="op">$</span><span class="va">df</span>
<span class="va">smp_def</span> <span class="op">&lt;-</span> <span class="va">smp_list</span><span class="op">$</span><span class="va">df_def</span></code></pre></div>
<p>If you are not that familiar yet with R, the above might look a little bit intimidating. Let’s explore it step by step. The first large part of the code, starting with <code>create_sample</code> and ending several lines later with the closing curly bracket on a separate line defines a function. A function is a block of code that can take parameters and returns an object. The function is named <code>create_sample</code> and that is what it does: It creates the sample that is being used in the analysis further below. You see that the function is being called after loading the data with the command <code>create_sample(nb_df, nb_df_def)</code>. Let’s look at the data that is passed on to the function before exploring what the function does in detail. After loading <code>"ExPanD_nb_data.Rdata"</code>, you have the data frames <code>nb_df</code> and <code>nb_df_def</code> in your environment. The first contains the raw data for the analysis in long format. See:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">nb_df</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
coid
</th>
<th style="text-align:left;">
period
</th>
<th style="text-align:left;">
coname
</th>
<th style="text-align:left;">
sector
</th>
<th style="text-align:left;">
industry
</th>
<th style="text-align:right;">
toas
</th>
<th style="text-align:right;">
sales
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
FY2013
</td>
<td style="text-align:left;">
Agilent Technologies, Inc. 
</td>
<td style="text-align:left;">
Capital Goods
</td>
<td style="text-align:left;">
Biotechnology: Laboratory Analytical Instruments
</td>
<td style="text-align:right;">
10686
</td>
<td style="text-align:right;">
3894
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
FY2014
</td>
<td style="text-align:left;">
Agilent Technologies, Inc. 
</td>
<td style="text-align:left;">
Capital Goods
</td>
<td style="text-align:left;">
Biotechnology: Laboratory Analytical Instruments
</td>
<td style="text-align:right;">
10815
</td>
<td style="text-align:right;">
4048
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
FY2015
</td>
<td style="text-align:left;">
Agilent Technologies, Inc. 
</td>
<td style="text-align:left;">
Capital Goods
</td>
<td style="text-align:left;">
Biotechnology: Laboratory Analytical Instruments
</td>
<td style="text-align:right;">
7479
</td>
<td style="text-align:right;">
4038
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
FY2016
</td>
<td style="text-align:left;">
Agilent Technologies, Inc. 
</td>
<td style="text-align:left;">
Capital Goods
</td>
<td style="text-align:left;">
Biotechnology: Laboratory Analytical Instruments
</td>
<td style="text-align:right;">
7794
</td>
<td style="text-align:right;">
4202
</td>
</tr>
<tr>
<td style="text-align:left;">
AA
</td>
<td style="text-align:left;">
FY2014
</td>
<td style="text-align:left;">
Alcoa Corporation
</td>
<td style="text-align:left;">
Capital Goods
</td>
<td style="text-align:left;">
Metal Fabrications
</td>
<td style="text-align:right;">
18680
</td>
<td style="text-align:right;">
13147
</td>
</tr>
<tr>
<td style="text-align:left;">
AA
</td>
<td style="text-align:left;">
FY2015
</td>
<td style="text-align:left;">
Alcoa Corporation
</td>
<td style="text-align:left;">
Capital Goods
</td>
<td style="text-align:left;">
Metal Fabrications
</td>
<td style="text-align:right;">
16413
</td>
<td style="text-align:right;">
11199
</td>
</tr>
</tbody>
</table>
<p>What is the second data frame for? Let’s have a peak:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">kable</span><span class="op">(</span><span class="va">nb_df_def</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
var_name
</th>
<th style="text-align:left;">
var_def
</th>
<th style="text-align:left;">
type
</th>
<th style="text-align:left;">
can_be_na
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
coid
</td>
<td style="text-align:left;">
Company identifier
</td>
<td style="text-align:left;">
cs_id
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
period
</td>
<td style="text-align:left;">
Fiscal year
</td>
<td style="text-align:left;">
ts_id
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
coname
</td>
<td style="text-align:left;">
Company name
</td>
<td style="text-align:left;">
cs_id
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
sector
</td>
<td style="text-align:left;">
Sector
</td>
<td style="text-align:left;">
factor
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
industry
</td>
<td style="text-align:left;">
Industry
</td>
<td style="text-align:left;">
factor
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
toas
</td>
<td style="text-align:left;">
Total assets at period end (M US-$)
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
sales
</td>
<td style="text-align:left;">
Sales of the period (M US-$)
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
equity
</td>
<td style="text-align:left;">
Total equity at period end (M US-$)
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
debt_ta
</td>
<td style="text-align:left;">
Total debt (% total assets)
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
eq_ta
</td>
<td style="text-align:left;">
Total equity (% total assets)
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
gw_ta
</td>
<td style="text-align:left;">
Goodwill (% total assets)
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
oint_ta
</td>
<td style="text-align:left;">
Other intangible assets (% total assets)
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
ppe_ta
</td>
<td style="text-align:left;">
Property, plant and equipment (% total assets)
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
ca_ta
</td>
<td style="text-align:left;">
Current assets (% total assets)
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
cash_ta
</td>
<td style="text-align:left;">
Cash (% total assets)
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
roe
</td>
<td style="text-align:left;">
Return on equity (net income divided by average equity)
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
roa
</td>
<td style="text-align:left;">
Return on assets (earnings before interest and taxes divided by average equity)
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
nioa
</td>
<td style="text-align:left;">
Net income divided by average assets
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
cfoa
</td>
<td style="text-align:left;">
Cash flow from operations divided by average assets
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
accoa
</td>
<td style="text-align:left;">
Total accruals divided by average assets
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
cogs_sales
</td>
<td style="text-align:left;">
Cost of goods sold divided by sales
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
ebit_sales
</td>
<td style="text-align:left;">
Earnings before interest and taxes divided by sales
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
ni_sales
</td>
<td style="text-align:left;">
Net income divided by sales
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
return
</td>
<td style="text-align:left;">
Stock return of the period (%)
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
</tbody>
</table>
<p>So this data frame contains variable definitions and defines how ExPanD should treat the variables. <code>type</code> indicates the cross-sectional (<code>cs_id</code>) and time series (<code>ts_id</code>) identifiers as well as whether the variables should be understood as numeric, logical or as a factor. <code>can_be_na</code> indicates whether ExPanD should require the variable to be not <code>NA</code>. If <code>can_be_na</code> is set to <code>FALSE</code> for a variable and its data is missing for a certain observation then ExPanD drops the whole observation (the row of the data frame) from the analysis.</p>
<p>The function <code>create_sample</code> now uses both data frames to prepare the sample for the analysis. It first sets all non finite numerical values to <code>NA</code>. Next, it checks whether any variables contain only <code>NA</code> observations and, if such variables are present in the data frame, it deletes them. After that, observations with <code>NA</code> values for variables that have set <code>can_be_na = FALSE</code> are deleted. Last, the outlier treatment as specified in the ExPanD app is applied to the data by calling the <code>ExPanDaR</code> function <code><a href="../reference/treat_outliers.html">treat_outliers()</a></code>. The default configuration that you used when calling ExPanD specified that the data should be winsorized at the top and bottom 1% percentile, meaning that values above the top 1% or below the bottom 1% will be set to the respective percentiles.</p>
<p>After these data preparation steps the modified data frames containing the data and its definitions are returned to the user, wrapped into a list object. The last two commands store these data frames into <code>smp</code> and <code>smp_def</code>. The remaining code will use these data frames for the analysis.</p>
<p>The rest of the notebook is much easier to process. For example, the chunk</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">smp</span>
<span class="va">df</span><span class="op">$</span><span class="va">period</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">period</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">sector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">sector</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">period</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill<span class="op">=</span> <span class="va">sector</span><span class="op">)</span>, position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"period"</span>, fill <span class="op">=</span> <span class="st">"sector"</span><span class="op">)</span>
<span class="va">p</span></code></pre></div>
<p><img src="ExPanD_notebook_files/figure-html/bar_chart-1.png" width="576" style="display: block; margin: auto;"></p>
<p>provides a stacked bar chart of the ExPanD app.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>When you look at the histogram for a given variable (as produced by the sixth chunk)</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">smp</span><span class="op">$</span><span class="va">nioa</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">var</span>, main<span class="op">=</span><span class="st">""</span>, xlab <span class="op">=</span> <span class="st">"nioa"</span>, col<span class="op">=</span><span class="st">"red"</span>, right <span class="op">=</span> <span class="cn">FALSE</span>, breaks<span class="op">=</span> <span class="fl">150</span><span class="op">)</span></code></pre></div>
<p><img src="ExPanD_notebook_files/figure-html/histogram-1.png" width="576" style="display: block; margin: auto;"></p>
<p>you directly see the effect of winsorization on the data (Net Income divided by average total assets in this case).</p>
<p>Most of the chunks make use of the wrapper functions provided by the <code>ExPanDaR</code> package. For one, the fifth chunk uses <code><a href="../reference/prepare_descriptive_table.html">prepare_descriptive_table()</a></code> to quickly produce a standard descriptive statistics table.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">smp</span>
<span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_descriptive_table.html">prepare_descriptive_table</a></span><span class="op">(</span><span class="va">smp</span><span class="op">)</span>
<span class="va">t</span><span class="op">$</span><span class="va">kable_ret</span>  <span class="op">%&gt;%</span>
  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"condensed"</span>, full_width <span class="op">=</span> <span class="cn">F</span>, position <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span></code></pre></div>
<table class="table table table-condensed">
<caption>
Descriptive Statistics
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
N
</th>
<th style="text-align:right;">
Mean
</th>
<th style="text-align:right;">
Std. dev.
</th>
<th style="text-align:right;">
Min.
</th>
<th style="text-align:right;">
25 %
</th>
<th style="text-align:right;">
Median
</th>
<th style="text-align:right;">
75 %
</th>
<th style="text-align:right;">
Max.
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
toas
</td>
<td style="text-align:right;">
8,770
</td>
<td style="text-align:right;">
7,120.241
</td>
<td style="text-align:right;">
17,672.452
</td>
<td style="text-align:right;">
32.797
</td>
<td style="text-align:right;">
436.235
</td>
<td style="text-align:right;">
1,532.440
</td>
<td style="text-align:right;">
4,943.997
</td>
<td style="text-align:right;">
123,268.709
</td>
</tr>
<tr>
<td style="text-align:left;">
sales
</td>
<td style="text-align:right;">
8,777
</td>
<td style="text-align:right;">
4,307.316
</td>
<td style="text-align:right;">
10,942.386
</td>
<td style="text-align:right;">
0.638
</td>
<td style="text-align:right;">
281.050
</td>
<td style="text-align:right;">
926.670
</td>
<td style="text-align:right;">
3,094.020
</td>
<td style="text-align:right;">
79,966.280
</td>
</tr>
<tr>
<td style="text-align:left;">
equity
</td>
<td style="text-align:right;">
8,770
</td>
<td style="text-align:right;">
2,294.681
</td>
<td style="text-align:right;">
5,610.286
</td>
<td style="text-align:right;">
-705.284
</td>
<td style="text-align:right;">
179.058
</td>
<td style="text-align:right;">
554.135
</td>
<td style="text-align:right;">
1,666.255
</td>
<td style="text-align:right;">
39,737.850
</td>
</tr>
<tr>
<td style="text-align:left;">
debt_ta
</td>
<td style="text-align:right;">
8,770
</td>
<td style="text-align:right;">
0.277
</td>
<td style="text-align:right;">
0.235
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.064
</td>
<td style="text-align:right;">
0.253
</td>
<td style="text-align:right;">
0.424
</td>
<td style="text-align:right;">
0.991
</td>
</tr>
<tr>
<td style="text-align:left;">
eq_ta
</td>
<td style="text-align:right;">
8,770
</td>
<td style="text-align:right;">
0.437
</td>
<td style="text-align:right;">
0.266
</td>
<td style="text-align:right;">
-0.466
</td>
<td style="text-align:right;">
0.277
</td>
<td style="text-align:right;">
0.446
</td>
<td style="text-align:right;">
0.621
</td>
<td style="text-align:right;">
0.930
</td>
</tr>
<tr>
<td style="text-align:left;">
gw_ta
</td>
<td style="text-align:right;">
6,382
</td>
<td style="text-align:right;">
0.174
</td>
<td style="text-align:right;">
0.153
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.047
</td>
<td style="text-align:right;">
0.132
</td>
<td style="text-align:right;">
0.268
</td>
<td style="text-align:right;">
0.610
</td>
</tr>
<tr>
<td style="text-align:left;">
oint_ta
</td>
<td style="text-align:right;">
6,754
</td>
<td style="text-align:right;">
0.096
</td>
<td style="text-align:right;">
0.111
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.018
</td>
<td style="text-align:right;">
0.057
</td>
<td style="text-align:right;">
0.136
</td>
<td style="text-align:right;">
0.576
</td>
</tr>
<tr>
<td style="text-align:left;">
ppe_ta
</td>
<td style="text-align:right;">
8,003
</td>
<td style="text-align:right;">
0.270
</td>
<td style="text-align:right;">
0.273
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.060
</td>
<td style="text-align:right;">
0.157
</td>
<td style="text-align:right;">
0.402
</td>
<td style="text-align:right;">
0.938
</td>
</tr>
<tr>
<td style="text-align:left;">
ca_ta
</td>
<td style="text-align:right;">
7,670
</td>
<td style="text-align:right;">
0.449
</td>
<td style="text-align:right;">
0.248
</td>
<td style="text-align:right;">
0.040
</td>
<td style="text-align:right;">
0.240
</td>
<td style="text-align:right;">
0.435
</td>
<td style="text-align:right;">
0.632
</td>
<td style="text-align:right;">
0.978
</td>
</tr>
<tr>
<td style="text-align:left;">
cash_ta
</td>
<td style="text-align:right;">
8,303
</td>
<td style="text-align:right;">
0.136
</td>
<td style="text-align:right;">
0.164
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.026
</td>
<td style="text-align:right;">
0.079
</td>
<td style="text-align:right;">
0.181
</td>
<td style="text-align:right;">
0.863
</td>
</tr>
<tr>
<td style="text-align:left;">
roe
</td>
<td style="text-align:right;">
6,398
</td>
<td style="text-align:right;">
0.017
</td>
<td style="text-align:right;">
0.262
</td>
<td style="text-align:right;">
-1.388
</td>
<td style="text-align:right;">
-0.008
</td>
<td style="text-align:right;">
0.043
</td>
<td style="text-align:right;">
0.086
</td>
<td style="text-align:right;">
1.145
</td>
</tr>
<tr>
<td style="text-align:left;">
roa
</td>
<td style="text-align:right;">
6,399
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:right;">
0.086
</td>
<td style="text-align:right;">
-0.366
</td>
<td style="text-align:right;">
-0.001
</td>
<td style="text-align:right;">
0.023
</td>
<td style="text-align:right;">
0.051
</td>
<td style="text-align:right;">
0.201
</td>
</tr>
<tr>
<td style="text-align:left;">
nioa
</td>
<td style="text-align:right;">
6,399
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
0.077
</td>
<td style="text-align:right;">
-0.355
</td>
<td style="text-align:right;">
-0.002
</td>
<td style="text-align:right;">
0.017
</td>
<td style="text-align:right;">
0.037
</td>
<td style="text-align:right;">
0.147
</td>
</tr>
<tr>
<td style="text-align:left;">
cfoa
</td>
<td style="text-align:right;">
6,399
</td>
<td style="text-align:right;">
0.034
</td>
<td style="text-align:right;">
0.068
</td>
<td style="text-align:right;">
-0.280
</td>
<td style="text-align:right;">
0.021
</td>
<td style="text-align:right;">
0.041
</td>
<td style="text-align:right;">
0.065
</td>
<td style="text-align:right;">
0.178
</td>
</tr>
<tr>
<td style="text-align:left;">
accoa
</td>
<td style="text-align:right;">
6,399
</td>
<td style="text-align:right;">
-0.032
</td>
<td style="text-align:right;">
0.043
</td>
<td style="text-align:right;">
-0.209
</td>
<td style="text-align:right;">
-0.046
</td>
<td style="text-align:right;">
-0.026
</td>
<td style="text-align:right;">
-0.012
</td>
<td style="text-align:right;">
0.092
</td>
</tr>
<tr>
<td style="text-align:left;">
cogs_sales
</td>
<td style="text-align:right;">
8,109
</td>
<td style="text-align:right;">
0.538
</td>
<td style="text-align:right;">
0.240
</td>
<td style="text-align:right;">
0.020
</td>
<td style="text-align:right;">
0.355
</td>
<td style="text-align:right;">
0.569
</td>
<td style="text-align:right;">
0.729
</td>
<td style="text-align:right;">
0.982
</td>
</tr>
<tr>
<td style="text-align:left;">
ebit_sales
</td>
<td style="text-align:right;">
8,777
</td>
<td style="text-align:right;">
-0.952
</td>
<td style="text-align:right;">
6.570
</td>
<td style="text-align:right;">
-56.918
</td>
<td style="text-align:right;">
-0.002
</td>
<td style="text-align:right;">
0.068
</td>
<td style="text-align:right;">
0.148
</td>
<td style="text-align:right;">
0.615
</td>
</tr>
<tr>
<td style="text-align:left;">
ni_sales
</td>
<td style="text-align:right;">
8,777
</td>
<td style="text-align:right;">
-0.947
</td>
<td style="text-align:right;">
6.381
</td>
<td style="text-align:right;">
-55.198
</td>
<td style="text-align:right;">
-0.005
</td>
<td style="text-align:right;">
0.048
</td>
<td style="text-align:right;">
0.110
</td>
<td style="text-align:right;">
0.573
</td>
</tr>
<tr>
<td style="text-align:left;">
return
</td>
<td style="text-align:right;">
6,009
</td>
<td style="text-align:right;">
0.088
</td>
<td style="text-align:right;">
0.375
</td>
<td style="text-align:right;">
-0.707
</td>
<td style="text-align:right;">
-0.136
</td>
<td style="text-align:right;">
0.065
</td>
<td style="text-align:right;">
0.269
</td>
<td style="text-align:right;">
1.568
</td>
</tr>
</tbody>
</table>
<p>See the help pages of these functions and the <a href="ExPanDaR-functions.html">vignette “Using the functions of the ExPanDaR package”</a> for more information on how to use them. Also, you can always take a look at their code (just call their name without the brackets) to see what they do under the hood and to extend or modify them.</p>
</div>
<div id="modifying-and-extending-the-notebook" class="section level2">
<h2 class="hasAnchor">
<a href="#modifying-and-extending-the-notebook" class="anchor"></a>Modifying and Extending the Notebook</h2>
<p>Now that you understood how the notebook is set up, it is relatively easy to modify the notebook and extend your analysis without using ExPanD. For example: The chunk below from the notebook prepares a scatter plot of return relative to net income.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">smp</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"coid"</span>, <span class="st">"coname"</span>, <span class="st">"period"</span>, <span class="st">"nioa"</span>, <span class="st">"return"</span>, <span class="st">"sector"</span>, <span class="st">"toas"</span><span class="op">)</span><span class="op">]</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="op">]</span>
<span class="va">df</span><span class="op">$</span><span class="va">sector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">sector</span><span class="op">)</span>
<span class="fu"><a href="../reference/prepare_scatter_plot.html">prepare_scatter_plot</a></span><span class="op">(</span><span class="va">df</span>, <span class="st">"nioa"</span>, <span class="st">"return"</span>, color <span class="op">=</span> <span class="st">"sector"</span>, size <span class="op">=</span> <span class="st">"toas"</span>, loess <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</code></pre>
<p><img src="ExPanD_notebook_files/figure-html/scatter_plot1-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Let’s assume that in addition you want to see how cash flows from operations relate to stock returns. Easy! Just replace <code>"nioa"</code>, the name of the net income variable with <code>"cfoa"</code>, the name of the cash flow from operations variable.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">smp</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"coid"</span>, <span class="st">"coname"</span>, <span class="st">"period"</span>, <span class="st">"cfoa"</span>, <span class="st">"return"</span>, <span class="st">"sector"</span>, <span class="st">"toas"</span><span class="op">)</span><span class="op">]</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="op">]</span>
<span class="va">df</span><span class="op">$</span><span class="va">sector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">sector</span><span class="op">)</span>
<span class="fu"><a href="../reference/prepare_scatter_plot.html">prepare_scatter_plot</a></span><span class="op">(</span><span class="va">df</span>, <span class="st">"cfoa"</span>, <span class="st">"return"</span>, color <span class="op">=</span> <span class="st">"sector"</span>, size <span class="op">=</span> <span class="st">"toas"</span>, loess <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</code></pre>
<p><img src="ExPanD_notebook_files/figure-html/scatter_plot2-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Looks very similar, right? Now you are all set. Feel free to modify and extend your analysis along all possible dimensions. Code away and enjoy!</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>A remark for the R experts: Some of the code of the analysis chunks (e.g. the <code><a href="https://rdrr.io/r/base/factor.html">as.factor()</a></code> calls in the chunk above) is only needed because of the generic data types that ExPanD can handle and could be safely removed for a specific well-behaved data frame.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Joachim Gassen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
